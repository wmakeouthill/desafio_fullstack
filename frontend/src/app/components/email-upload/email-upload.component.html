<div class="email-upload-container">
  <header class="header">
    <h1>ğŸ“§ Classificador de Emails com IA</h1>
    <p class="subtitle">Classifique emails automaticamente e receba sugestÃµes de resposta</p>
  </header>

  <!-- Seletor de Provider -->
  <section class="provider-section">
    <label class="section-label">Provedor de IA</label>
    <div class="provider-buttons">
      @for (p of providersDisponiveis(); track p.value) {
        <button
          type="button"
          class="provider-btn"
          [class.active]="providerSelecionado() === p.value"
          [class.disabled]="!p.available"
          [disabled]="!p.available"
          (click)="onProviderChange(p.value)">
          @if (p.value === 'openai') {
            <span class="provider-icon">ğŸ¤–</span>
          } @else {
            <span class="provider-icon">âœ¨</span>
          }
          <span class="provider-name">{{ p.label }}</span>
          <span class="provider-model">{{ p.model }}</span>
          @if (!p.available) {
            <span class="provider-unavailable">NÃ£o configurado</span>
          }
        </button>
      }
    </div>
  </section>

  <!-- FormulÃ¡rio de entrada -->
  <section class="input-section">
    <label class="section-label">ConteÃºdo do Email</label>

    @if (!modoUpload()) {
      <textarea
        ngSkipHydration
        class="email-textarea"
        [ngModel]="conteudoEmail()"
        (ngModelChange)="conteudoEmail.set($event)"
        placeholder="Cole o conteÃºdo do email aqui... ou anexe no botÃ£o abaixo"
        rows="10"></textarea>
    }

    <div class="upload-area">
      <input
        type="file"
        accept=".txt,.pdf"
        (change)="onArquivoSelecionado($event)"
        #fileInput
        hidden>

      @if (arquivoSelecionado(); as arquivo) {
        <div class="arquivo-selecionado">
          <span class="arquivo-icon">ğŸ“„</span>
          <span class="arquivo-nome">{{ arquivo.name }}</span>
          <span class="arquivo-tamanho">({{ (arquivo.size / 1024).toFixed(1) }} KB)</span>
          <button type="button" class="btn-remover" (click)="limparArquivo()">âœ•</button>
        </div>
      } @else {
        <button type="button" class="btn-upload" (click)="fileInput.click()">
          ğŸ“ Selecionar Arquivo (.txt ou .pdf)
        </button>
      }
    </div>

    <button
      type="button"
      class="btn-enviar"
      [disabled]="!podeEnviar()"
      (click)="enviar()">
      @if (carregando()) {
        <span class="loading-spinner"></span>
        Processando...
      } @else {
        ğŸš€ Classificar Email
      }
    </button>
  </section>

  <!-- Erro -->
  @if (erro(); as mensagemErro) {
    <div class="erro-container">
      <span class="erro-icon">âš ï¸</span>
      <span class="erro-mensagem">{{ mensagemErro }}</span>
      <button type="button" class="btn-fechar" (click)="erro.set(null)">âœ•</button>
    </div>
  }

  <!-- Resultado -->
  @if (resultado(); as res) {
    <app-resultado-classificacao
      [resultado]="res"
      [provider]="providerSelecionado()"
      (novaClassificacao)="limparResultado()" />
  }
</div>
